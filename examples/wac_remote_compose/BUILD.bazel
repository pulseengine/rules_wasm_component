"""Example demonstrating WAC remote composition with wkg integration"""

load("@rules_wasm_component//wac:defs.bzl", "wac_remote_compose")
load("@rules_wasm_component//rust:defs.bzl", "rust_wasm_component_bindgen")
load("@rules_wasm_component//wit:defs.bzl", "wit_library")

package(default_visibility = ["//visibility:public"])

# Define WIT interfaces
wit_library(
    name = "frontend_interfaces",
    package_name = "frontend:app",  
    srcs = ["wit/frontend.wit"],
    world = "frontend",
)

# Local component that will be composed with remote components
rust_wasm_component_bindgen(
    name = "frontend",
    srcs = ["src/lib.rs"],
    wit = ":frontend_interfaces",
)

# Compose local component with remote components from registries
wac_remote_compose(
    name = "distributed_system",
    composition = """
        // Instantiate all components
        let frontend = new frontend:component { ... };
        let auth = new auth_service:component { ... };
        let data = new data_service:component { ... };

        // Connect frontend to remote services
        connect frontend.auth_request -> auth.validate;
        connect frontend.data_request -> data.query;

        // Export frontend as the main interface
        export frontend as main;
    """,
    local_components = {
        "frontend": ":frontend",
    },
    remote_components = {
        # Example remote components (these would need to exist in registries)
        "auth_service": "example-registry/auth@1.0.0",
        "data_service": "wasi:data@0.2.0",
    },
)

# Alternative example using composition file
wac_remote_compose(
    name = "microservices_system",
    composition_file = "composition/microservices.wac",
    local_components = {
        "gateway": ":local_frontend",
    },
    remote_components = {
        "user_service": "my-org/users@2.1.0",
        "payment_service": "my-org/payments@1.5.0",
    },
)
