// Analytics Service WIT Interface
// Defines the Go analytics and event processing service API

package example:analytics-service@1.0.0;

world analytics-service {
  // TinyGo runtime requires these WASI interfaces
  import wasi:io/streams@0.2.0;
  import wasi:cli/environment@0.2.0;
  import wasi:cli/exit@0.2.0;
  import wasi:cli/stdin@0.2.0;
  import wasi:cli/stdout@0.2.0;
  import wasi:cli/stderr@0.2.0;
  import wasi:clocks/monotonic-clock@0.2.0;
  import wasi:clocks/wall-clock@0.2.0;
  import wasi:filesystem/types@0.2.0;
  import wasi:filesystem/preopens@0.2.0;
  import wasi:random/random@0.2.0;

  export analytics-service: interface {

    // Analytics data structures
    record event-context {
      user-agent: string,
      ip-address: string,
      referrer: string,
      page: string,
      country: string,
      device-type: string,
    }

    record analytics-event {
      event-id: string,
      user-id: string,
      session-id: string,
      event-type: string,
      timestamp: u64,
      context: event-context,
    }

    record metric-aggregation {
      metric-name: string,
      time-window: string,
      value: f64,
      count: u64,
      aggregation-type: string,
    }

    record funnel-step {
      step-name: string,
      event-type: string,
      timeout-hours: u32,
    }

    record funnel-analysis {
      funnel-id: string,
      name: string,
      steps: list<funnel-step>,
    }

    // Core analytics functions
    track-event: func(event-data: list<u8>) -> bool;
    get-metrics: func(time-window: string) -> list<u8>;

    // Funnel analysis
    create-funnel: func(funnel-data: list<u8>) -> string;
    get-funnel-results: func(funnel-id: string) -> list<u8>;

    // Service management
    health-check: func() -> bool;
    get-service-stats: func() -> string;
  }
}
