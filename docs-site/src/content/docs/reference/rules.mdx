---
title: Rule Reference
description: Complete reference for all WebAssembly Component Model Bazel rules
---

# Rule Reference

Complete reference documentation for all Bazel rules provided by rules_wasm_component.

> **Note:** This documentation is automatically generated from rule definitions in the source code.
> For the most up-to-date information, see the [source repository](https://github.com/pulseengine/rules_wasm_component).

## Table of Contents

- [WIT & Interface Rules](#wit-interface-rules)
  - [wit_bindgen](#wit_bindgen)
  - [wit_deps_check](#wit_deps_check)
  - [wit_library](#wit_library)
  - [wit_markdown](#wit_markdown)
- [Rust Component Rules](#rust-component-rules)
  - [rust_wasm_component](#rust_wasm_component)
  - [rust_wasm_component_bindgen](#rust_wasm_component_bindgen)
  - [rust_wasm_component_test](#rust_wasm_component_test)
  - [rust_wasm_component_wizer](#rust_wasm_component_wizer)
- [Go Component Rules](#go-component-rules)
  - [go_wasm_component](#go_wasm_component)
  - [go_wasm_component_test](#go_wasm_component_test)
  - [go_wit_bindgen](#go_wit_bindgen)
- [JavaScript Component Rules](#javascript-component-rules)
  - [jco_transpile](#jco_transpile)
  - [js_component](#js_component)
  - [npm_install](#npm_install)
- [C++ Component Rules](#c-component-rules)
  - [cc_component_library](#cc_component_library)
  - [cpp_component](#cpp_component)
  - [cpp_wit_bindgen](#cpp_wit_bindgen)
- [Composition Rules](#composition-rules)
  - [wac_bundle](#wac_bundle)
  - [wac_compose](#wac_compose)
  - [wac_plug](#wac_plug)
  - [wac_remote_compose](#wac_remote_compose)
- [RPC & Communication](#rpc-communication)
  - [wrpc_bindgen](#wrpc_bindgen)
  - [wrpc_invoke](#wrpc_invoke)
  - [wrpc_serve](#wrpc_serve)
- [Component Tools](#component-tools)
  - [wasm_component_new](#wasm_component_new)
  - [wasm_component_wizer_library](#wasm_component_wizer_library)
  - [wasm_embed_aot](#wasm_embed_aot)
  - [wasm_extract_aot](#wasm_extract_aot)
  - [wasm_precompile](#wasm_precompile)
  - [wasm_run](#wasm_run)
  - [wasm_test](#wasm_test)
  - [wasm_validate](#wasm_validate)
- [Security & Signing](#security-signing)
  - [wasm_keygen](#wasm_keygen)
  - [wasm_sign](#wasm_sign)
  - [wasm_verify](#wasm_verify)
- [Registry & Distribution](#registry-distribution)
  - [wasm_component_from_oci](#wasm_component_from_oci)
  - [wkg_registry_config](#wkg_registry_config)
  - [wkg_fetch](#wkg_fetch)
  - [wkg_lock](#wkg_lock)
  - [wkg_publish](#wkg_publish)
  - [wkg_push](#wkg_push)
- [Providers](#providers)
  - [WacCompositionInfo](#waccompositioninfo)
  - [WasmComponentInfo](#wasmcomponentinfo)
  - [WasmPrecompiledInfo](#wasmprecompiledinfo)
  - [WitInfo](#witinfo)

## WIT & Interface Rules

### wit_bindgen

Generates language bindings from WIT files using wit-bindgen tool. Creates bindings for various target languages from WebAssembly Interface Types.

**Load from:**

```python
load("@rules_wasm_component//wit:defs.bzl", "wit_bindgen")
```

**Attributes:**

| Name       | Type                                         | Required | Description                             |
| ---------- | -------------------------------------------- | -------- | --------------------------------------- |
| `language` | String<br/>_Values: rust, c, go, python, js_ | ✅       | Target language for binding generation  |
| `name`     | String                                       | ✅       | A unique name for this target           |
| `options`  | List of Strings                              | ❌       | Additional options for wit-bindgen      |
| `wit`      | Label                                        | ✅       | WIT library to generate bindings for    |
| `world`    | String                                       | ❌       | Specific world to generate bindings for |

**Examples:**

Generate Rust bindings from WIT

```python
wit_bindgen(
    name = "rust_bindings",
    wit = ":my_interfaces",
    language = "rust",
)
```

### wit_deps_check

Analyzes a WIT file for missing dependencies and suggests fixes. Helps developers identify and resolve dependency issues.

**Load from:**

```python
load("@rules_wasm_component//wit:defs.bzl", "wit_deps_check")
```

**Attributes:**

| Name       | Type   | Required | Description                          |
| ---------- | ------ | -------- | ------------------------------------ |
| `name`     | String | ✅       | A unique name for this target        |
| `wit_file` | Label  | ✅       | WIT file to analyze for dependencies |

**Examples:**

Check a WIT file for missing dependencies

```python
wit_deps_check(
    name = "check_deps",
    wit_file = "consumer.wit",
)
```

### wit_library

Defines a WIT (WebAssembly Interface Types) library. Processes WIT files and makes them available for use in WASM component builds and binding generation.

**Load from:**

```python
load("@rules_wasm_component//wit:defs.bzl", "wit_library")
```

**Attributes:**

| Name           | Type            | Required | Description                                                                            |
| -------------- | --------------- | -------- | -------------------------------------------------------------------------------------- |
| `deps`         | List of Labels  | ❌       | WIT library dependencies. Each dependency must provide WitInfo.                        |
| `interfaces`   | List of Strings | ❌       | List of interface names defined in this library                                        |
| `name`         | String          | ✅       | A unique name for this target                                                          |
| `package_name` | String          | ❌       | WIT package name (e.g., 'my:package@1.0.0'). Defaults to target name if not specified. |
| `srcs`         | List of Labels  | ✅       | WIT source files (\*.wit)                                                              |
| `world`        | String          | ❌       | Optional world name to export from this library                                        |

**Examples:**

#### Simple WIT library

Basic WIT library with a single interface file

```python
wit_library(
    name = "my_interfaces",
    package_name = "my:pkg@1.0.0",
    srcs = ["interfaces.wit"],
)
```

#### WIT library with dependencies

WIT library that imports from another package

```python
wit_library(
    name = "consumer_interfaces",
    package_name = "consumer:app@1.0.0",
    srcs = ["consumer.wit"],
    deps = ["//external:lib_interfaces"],
)
```

### wit_markdown

Generates markdown documentation from WIT files. Creates human-readable documentation from WebAssembly Interface Types.

**Load from:**

```python
load("@rules_wasm_component//wit:defs.bzl", "wit_markdown")
```

**Attributes:**

| Name   | Type   | Required | Description                               |
| ------ | ------ | -------- | ----------------------------------------- |
| `name` | String | ✅       | A unique name for this target             |
| `wit`  | Label  | ✅       | WIT library to generate documentation for |

**Examples:**

Create markdown documentation from WIT

```python
wit_markdown(
    name = "api_docs",
    wit = ":my_interfaces",
)
```

## Rust Component Rules

### rust_wasm_component

Builds a Rust WebAssembly component. Compiles Rust source code into a WASM component using the Rust toolchain.

**Load from:**

```python
load("@rules_wasm_component//rust:defs.bzl", "rust_wasm_component")
```

**Attributes:**

| Name             | Type            | Required | Description                   |
| ---------------- | --------------- | -------- | ----------------------------- |
| `adapter`        | Label           | ❌       | Optional WASI adapter         |
| `crate_features` | List of Strings | ❌       | Rust crate features           |
| `deps`           | List of Labels  | ❌       | Rust dependencies (crates)    |
| `name`           | String          | ✅       | A unique name for this target |
| `rustc_flags`    | List of Strings | ❌       | Additional rustc flags        |
| `srcs`           | List of Labels  | ✅       | Rust source files             |

**Examples:**

Simple Rust WASM component

```python
rust_wasm_component(
    name = "my_component",
    srcs = ["src/lib.rs"],
    deps = ["@crates//:serde"],
)
```

### rust_wasm_component_bindgen

Builds a Rust WebAssembly component with WIT binding generation. Compiles Rust source code into a WASM component and generates language bindings from WIT interfaces.

**Load from:**

```python
load("@rules_wasm_component//rust:defs.bzl", "rust_wasm_component_bindgen")
```

**Attributes:**

| Name       | Type                                                                            | Required | Description                                                    |
| ---------- | ------------------------------------------------------------------------------- | -------- | -------------------------------------------------------------- |
| `deps`     | List of Labels                                                                  | ❌       | Rust dependencies (crates)                                     |
| `name`     | String                                                                          | ✅       | A unique name for this target                                  |
| `profiles` | List of Strings<br/>_Default: ['release']_<br/>_Values: debug, release, custom_ | ❌       | Build profiles to generate                                     |
| `srcs`     | List of Labels                                                                  | ✅       | Rust source files                                              |
| `wit`      | Label                                                                           | ✅       | WIT library target that provides interfaces for this component |

**Examples:**

#### Basic Rust component

Simple Rust WASM component with WIT bindings

```python
rust_wasm_component_bindgen(
    name = "my_component",
    srcs = ["src/lib.rs"],
    wit = ":my_interfaces",
)
```

#### Multi-profile component

Component built with multiple optimization profiles

```python
rust_wasm_component_bindgen(
    name = "my_component",
    srcs = ["src/lib.rs"],
    wit = ":my_interfaces",
    profiles = ["debug", "release"],
)
```

### rust_wasm_component_test

Tests a Rust WASM component using wasmtime runtime. Provides automated testing for WebAssembly components.

**Load from:**

```python
load("@rules_wasm_component//rust:defs.bzl", "rust_wasm_component_test")
```

**Attributes:**

| Name        | Type   | Required | Description                   |
| ----------- | ------ | -------- | ----------------------------- |
| `component` | Label  | ✅       | WASM component to test        |
| `name`      | String | ✅       | A unique name for this target |

**Examples:**

Test a WASM component

```python
rust_wasm_component_test(
    name = "my_component_test",
    component = ":my_component",
)
```

### rust_wasm_component_wizer

Builds a Rust WebAssembly component with Wizer pre-initialization. Provides 1.35-6x startup performance improvements by running initialization code at build time.

**Load from:**

```python
load("@rules_wasm_component//rust:defs.bzl", "rust_wasm_component_wizer")
```

**Attributes:**

| Name                 | Type                                                        | Required | Description                               |
| -------------------- | ----------------------------------------------------------- | -------- | ----------------------------------------- |
| `adapter`            | Label                                                       | ❌       | Optional WASI adapter                     |
| `crate_features`     | List of Strings                                             | ❌       | Cargo features to enable                  |
| `crate_root`         | Label                                                       | ❌       | Crate root file (defaults to src/lib.rs)  |
| `deps`               | List of Labels                                              | ❌       | Rust dependencies                         |
| `edition`            | String<br/>_Default: '2021'_<br/>_Values: 2015, 2018, 2021_ | ❌       | Rust edition                              |
| `init_function_name` | String<br/>_Default: 'wizer.initialize'_                    | ❌       | Name of the Wizer initialization function |
| `name`               | String                                                      | ✅       | A unique name for this target             |
| `profiles`           | List of Strings<br/>_Values: debug, release_                | ❌       | Build profiles (debug, release)           |
| `rustc_flags`        | List of Strings                                             | ❌       | Additional rustc flags                    |
| `srcs`               | List of Labels                                              | ✅       | Rust source files                         |
| `wit`                | Label                                                       | ❌       | WIT library for binding generation        |

**Examples:**

Rust component with pre-initialization

```python
rust_wasm_component_wizer(
    name = "optimized_component",
    srcs = ["src/lib.rs"],
    wit = "//interfaces:calculator",
    init_function_name = "wizer.initialize",
    profiles = ["release"],
)
```

## Go Component Rules

### go_wasm_component

Builds a Go WebAssembly component using TinyGo. Compiles Go source code into a WASM component with WASI Preview 2 support.

**Load from:**

```python
load("@rules_wasm_component//go:defs.bzl", "go_wasm_component")
```

**Attributes:**

| Name           | Type                                                         | Required | Description                           |
| -------------- | ------------------------------------------------------------ | -------- | ------------------------------------- |
| `adapter`      | Label                                                        | ❌       | Optional WASI adapter                 |
| `go_mod`       | Label                                                        | ❌       | go.mod file for dependency management |
| `name`         | String                                                       | ✅       | A unique name for this target         |
| `optimization` | String<br/>_Default: 'release'_<br/>_Values: debug, release_ | ❌       | Build optimization level              |
| `srcs`         | List of Labels                                               | ✅       | Go source files                       |
| `world`        | String                                                       | ❌       | WIT world for the component           |

**Examples:**

Simple Go WASM component with TinyGo

```python
go_wasm_component(
    name = "calculator_component",
    srcs = ["calculator.go", "main.go"],
    go_mod = "go.mod",
    optimization = "release",
)
```

### go_wasm_component_test

Tests a Go WebAssembly component built with TinyGo. Performs comprehensive validation including component format verification, TinyGo-specific pattern checks, and WASI Preview 2 compatibility testing.

**Load from:**

```python
load("@rules_wasm_component//go:defs.bzl", "go_wasm_component_test")
```

**Attributes:**

| Name        | Type   | Required | Description                   |
| ----------- | ------ | -------- | ----------------------------- |
| `component` | Label  | ✅       | Go WASM component to test     |
| `name`      | String | ✅       | A unique name for this target |

**Examples:**

Test a TinyGo WebAssembly component

```python
go_wasm_component_test(
    name = "calculator_component_test",
    component = ":calculator_component",
)
```

### go_wit_bindgen

Legacy compatibility function for Go WIT binding generation. **DEPRECATED**: WIT binding generation is now handled automatically by go_wasm_component rule. This function exists for backward compatibility with existing examples and creates a placeholder genrule. For new code, use go_wasm_component directly with wit and world attributes.

**Load from:**

```python
load("@rules_wasm_component//go:defs.bzl", "go_wit_bindgen")
```

**Attributes:**

| Name   | Type   | Required | Description                   |
| ------ | ------ | -------- | ----------------------------- |
| `name` | String | ✅       | A unique name for this target |

**Examples:**

Placeholder for backward compatibility (use go_wasm_component instead)

```python
// DEPRECATED: Use go_wasm_component instead
go_wit_bindgen(
    name = "calculator_bindings",
)

// RECOMMENDED: Use go_wasm_component directly
go_wasm_component(
    name = "calculator_component",
    srcs = ["calculator.go"],
    wit = ":calculator_wit",
    world = "calculator",
)
```

## JavaScript Component Rules

### jco_transpile

Transpiles WebAssembly components to JavaScript using jco (JavaScript Component Tools). Converts WASM components into JavaScript modules.

**Load from:**

```python
load("@rules_wasm_component//js:defs.bzl", "jco_transpile")
```

**Attributes:**

| Name        | Type            | Required | Description                        |
| ----------- | --------------- | -------- | ---------------------------------- |
| `component` | Label           | ✅       | WebAssembly component to transpile |
| `name`      | String          | ✅       | A unique name for this target      |
| `options`   | List of Strings | ❌       | Additional jco options             |

**Examples:**

Convert WASM component to JavaScript

```python
jco_transpile(
    name = "calculator_js_bindings",
    component = ":calculator_component",
)
```

### js_component

Builds a JavaScript WebAssembly component using ComponentizeJS. Transpiles JavaScript/TypeScript source code into a WASM component.

**Load from:**

```python
load("@rules_wasm_component//js:defs.bzl", "js_component")
```

**Attributes:**

| Name           | Type                           | Required | Description                                        |
| -------------- | ------------------------------ | -------- | -------------------------------------------------- |
| `entry_point`  | String<br/>_Default: index.js_ | ❌       | Main entry point file                              |
| `name`         | String                         | ✅       | A unique name for this target                      |
| `package_json` | Label                          | ❌       | package.json file (auto-generated if not provided) |
| `srcs`         | List of Labels                 | ✅       | JavaScript/TypeScript source files                 |
| `wit`          | Label                          | ✅       | WIT library for the component interfaces           |

**Examples:**

JavaScript WebAssembly component

```python
js_component(
    name = "calculator_js",
    srcs = ["src/calculator.js"],
    wit = ":calculator_wit",
)
```

### npm_install

Installs NPM dependencies for JavaScript components. Runs npm install to fetch dependencies specified in package.json, making them available for JavaScript component builds.

**Load from:**

```python
load("@rules_wasm_component//js:defs.bzl", "npm_install")
```

**Attributes:**

| Name           | Type   | Required | Description                         |
| -------------- | ------ | -------- | ----------------------------------- |
| `name`         | String | ✅       | A unique name for this target       |
| `package_json` | Label  | ✅       | package.json file with dependencies |

**Examples:**

Install NPM dependencies

```python
npm_install(
    name = "npm_deps",
    package_json = "package.json",
)
```

## C++ Component Rules

### cc_component_library

Creates a static library for use in WebAssembly components. Compiles C/C++ source files into a static library that can be linked into WebAssembly components.

**Load from:**

```python
load("@rules_wasm_component//cpp:defs.bzl", "cc_component_library")
```

**Attributes:**

| Name                | Type                                             | Required | Description                                       |
| ------------------- | ------------------------------------------------ | -------- | ------------------------------------------------- |
| `copts`             | List of Strings                                  | ❌       | Additional compiler options                       |
| `cxx_std`           | String                                           | ❌       | C++ standard (e.g., c++17, c++20, c++23)          |
| `defines`           | List of Strings                                  | ❌       | Preprocessor definitions                          |
| `deps`              | List of Labels                                   | ❌       | Dependencies (other cc_component_library targets) |
| `enable_exceptions` | Boolean                                          | ❌       | Enable C++ exceptions (increases binary size)     |
| `hdrs`              | List of Labels                                   | ❌       | C/C++ header files                                |
| `includes`          | List of Strings                                  | ❌       | Additional include directories                    |
| `language`          | String<br/>_Default: 'cpp'_<br/>_Values: c, cpp_ | ❌       | Language variant (c or cpp)                       |
| `name`              | String                                           | ✅       | A unique name for this target                     |
| `optimize`          | Boolean<br/>_Default: True_                      | ❌       | Enable optimizations                              |
| `srcs`              | List of Labels                                   | ✅       | C/C++ source files                                |

**Examples:**

Create a static library for components

```python
cc_component_library(
    name = "math_utils",
    srcs = ["math.cpp", "algorithms.cpp"],
    hdrs = ["math.h", "algorithms.h"],
    language = "cpp",
    cxx_std = "c++20",
    optimize = True,
)
```

### cpp_component

Builds a C++ WebAssembly component using WASI SDK. Compiles C++ source code into a WASM component with Preview2 support.

**Load from:**

```python
load("@rules_wasm_component//cpp:defs.bzl", "cpp_component")
```

**Attributes:**

| Name   | Type           | Required | Description                          |
| ------ | -------------- | -------- | ------------------------------------ |
| `deps` | List of Labels | ❌       | C++ dependencies                     |
| `hdrs` | List of Labels | ❌       | C++ header files                     |
| `name` | String         | ✅       | A unique name for this target        |
| `srcs` | List of Labels | ✅       | C++ source files                     |
| `wit`  | Label          | ❌       | WIT library for component interfaces |

**Examples:**

C++ WebAssembly component

```python
cpp_component(
    name = "calculator_cpp",
    srcs = ["calculator.cpp"],
    hdrs = ["calculator.h"],
)
```

### cpp_wit_bindgen

Generates C/C++ bindings from WIT interface definitions. Creates header and source files for WebAssembly component development.

**Load from:**

```python
load("@rules_wasm_component//cpp:defs.bzl", "cpp_wit_bindgen")
```

**Attributes:**

| Name              | Type                                            | Required | Description                                         |
| ----------------- | ----------------------------------------------- | -------- | --------------------------------------------------- |
| `name`            | String                                          | ✅       | A unique name for this target                       |
| `string_encoding` | String<br/>_Values: utf8, utf16, compact-utf16_ | ❌       | String encoding to use in generated bindings        |
| `stubs_only`      | Boolean                                         | ❌       | Generate only stub functions without implementation |
| `wit`             | Label                                           | ✅       | WIT interface definition file                       |
| `world`           | String                                          | ❌       | WIT world to generate bindings for                  |

**Examples:**

Generate C++ bindings from WIT

```python
cpp_wit_bindgen(
    name = "calculator_bindings",
    wit = "calculator.wit",
    world = "calculator",
    string_encoding = "utf8",
)
```

## Composition Rules

### wac_bundle

Bundle WASM components without composition, suitable for WASI components. Collects multiple components into a single bundle directory without creating a composed component.

**Load from:**

```python
load("@rules_wasm_component//wac:defs.bzl", "wac_bundle")
```

**Attributes:**

| Name         | Type                    | Required | Description                                           |
| ------------ | ----------------------- | -------- | ----------------------------------------------------- |
| `components` | label_keyed_string_dict | ✅       | Map of component targets to their names in the bundle |
| `name`       | String                  | ✅       | A unique name for this target                         |

**Examples:**

Bundle multiple WASI components

```python
wac_bundle(
    name = "service_bundle",
    components = {
        ":auth_service": "auth",
        ":data_service": "data",
        ":api_service": "api",
    },
)
```

### wac_compose

Composes multiple WebAssembly components into a single application using WAC (WebAssembly Composition) format.

**Load from:**

```python
load("@rules_wasm_component//wac:defs.bzl", "wac_compose")
```

**Attributes:**

| Name               | Type                            | Required | Description                                                |
| ------------------ | ------------------------------- | -------- | ---------------------------------------------------------- |
| `components`       | String Dictionary               | ✅       | Map of component targets to component names in composition |
| `composition`      | String                          | ❌       | Inline WAC composition script                              |
| `composition_file` | Label                           | ❌       | WAC composition file (alternative to inline composition)   |
| `name`             | String                          | ✅       | A unique name for this target                              |
| `profile`          | String<br/>_Default: 'release'_ | ❌       | Build profile for components                               |

**Examples:**

Compose two components with inline WAC script

```python
wac_compose(
    name = "my_app",
    components = {
        ":component_a": "comp_a",
        ":component_b": "comp_b",
    },
    composition = '''
        let a = new comp_a {};
        let b = new comp_b {};
        export a;
    ''',
)
```

### wac_plug

Plug component exports into component imports using WAC. Automatically connects component exports to imports through WAC's plug functionality.

**Load from:**

```python
load("@rules_wasm_component//wac:defs.bzl", "wac_plug")
```

**Attributes:**

| Name     | Type           | Required | Description                                 |
| -------- | -------------- | -------- | ------------------------------------------- |
| `name`   | String         | ✅       | A unique name for this target               |
| `plugs`  | List of Labels | ✅       | The plug components that export functions   |
| `socket` | Label          | ✅       | The socket component that imports functions |

**Examples:**

Connect exports to imports automatically

```python
wac_plug(
    name = "connected_app",
    socket = ":main_component",
    plugs = [
        ":auth_plugin",
        ":storage_plugin",
    ],
)
```

### wac_remote_compose

Composes WebAssembly components including remote components from OCI registries. Enables distributed component architecture.

**Load from:**

```python
load("@rules_wasm_component//wac:defs.bzl", "wac_remote_compose")
```

**Attributes:**

| Name                | Type              | Required | Description                           |
| ------------------- | ----------------- | -------- | ------------------------------------- |
| `composition_file`  | Label             | ❌       | WAC composition file                  |
| `local_components`  | String Dictionary | ❌       | Local component targets               |
| `name`              | String            | ✅       | A unique name for this target         |
| `registry_config`   | Label             | ❌       | Registry configuration for OCI access |
| `remote_components` | String Dictionary | ❌       | Remote OCI component references       |

**Examples:**

Compose local and remote components

```python
wac_remote_compose(
    name = "distributed_app",
    local_components = {
        ":frontend": "frontend",
    },
    remote_components = {
        "ghcr.io/org/backend:v1.0.0": "backend",
    },
    composition_file = "app.wac",
)
```

## RPC & Communication

### wrpc_bindgen

Generates language bindings for wrpc (WebAssembly Component RPC) from WIT interfaces. Creates client and server stubs for remote component communication.

**Load from:**

```python
load("@rules_wasm_component//wrpc:defs.bzl", "wrpc_bindgen")
```

**Attributes:**

| Name       | Type                                                | Required | Description                        |
| ---------- | --------------------------------------------------- | -------- | ---------------------------------- |
| `language` | String<br/>_Default: 'rust'_<br/>_Values: rust, go_ | ❌       | Target language for bindings       |
| `name`     | String                                              | ✅       | A unique name for this target      |
| `wit`      | Label                                               | ✅       | WIT file defining the interface    |
| `world`    | String                                              | ✅       | WIT world to generate bindings for |

**Examples:**

Generate Rust RPC bindings from WIT

```python
wrpc_bindgen(
    name = "api_bindings",
    wit = "api.wit",
    world = "api-world",
    language = "rust",
)
```

### wrpc_invoke

Invokes functions on remote WebAssembly components via wrpc. Creates executable scripts to call remote component functions.

**Load from:**

```python
load("@rules_wasm_component//wrpc:defs.bzl", "wrpc_invoke")
```

**Attributes:**

| Name        | Type                                                | Required | Description                            |
| ----------- | --------------------------------------------------- | -------- | -------------------------------------- |
| `address`   | String<br/>_Default: 'localhost:8080'_              | ❌       | Address of the remote component        |
| `function`  | String                                              | ✅       | Function to invoke on remote component |
| `name`      | String                                              | ✅       | A unique name for this target          |
| `transport` | String<br/>_Default: 'tcp'_<br/>_Values: tcp, nats_ | ❌       | Transport protocol                     |

**Examples:**

Invoke a function on remote component

```python
wrpc_invoke(
    name = "call_api",
    function = "process-data",
    transport = "tcp",
    address = "localhost:8080",
)
```

### wrpc_serve

Serves a WebAssembly component via wrpc for remote procedure calls. Creates executable scripts to run components as RPC servers.

**Load from:**

```python
load("@rules_wasm_component//wrpc:defs.bzl", "wrpc_serve")
```

**Attributes:**

| Name        | Type                                                | Required | Description                    |
| ----------- | --------------------------------------------------- | -------- | ------------------------------ |
| `address`   | String<br/>_Default: '0.0.0.0:8080'_                | ❌       | Address to bind server to      |
| `component` | Label                                               | ✅       | WebAssembly component to serve |
| `name`      | String                                              | ✅       | A unique name for this target  |
| `transport` | String<br/>_Default: 'tcp'_<br/>_Values: tcp, nats_ | ❌       | Transport protocol             |

**Examples:**

Serve a component as RPC server

```python
wrpc_serve(
    name = "api_server",
    component = ":my_component",
    transport = "tcp",
    address = "0.0.0.0:8080",
)
```

## Component Tools

### wasm_component_new

Creates a WebAssembly component from a core WASM module using wasm-tools component new. Wraps core modules into the component model.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_component_new")
```

**Attributes:**

| Name      | Type   | Required | Description                   |
| --------- | ------ | -------- | ----------------------------- |
| `adapter` | Label  | ❌       | WASI adapter to use           |
| `module`  | Label  | ✅       | Core WASM module to wrap      |
| `name`    | String | ✅       | A unique name for this target |

**Examples:**

Convert core WASM module to component

```python
wasm_component_new(
    name = "my_component",
    module = ":my_module",
    adapter = "//wasm/adapters:wasi_snapshot_preview1",
)
```

### wasm_component_wizer_library

Pre-initializes a WebAssembly component using Wizer library for improved startup performance. Executes initialization functions at build time to reduce runtime overhead.

**Load from:**

```python
load("@rules_wasm_component//wasm:wasm_component_wizer_library.bzl", "wasm_component_wizer_library")
```

**Attributes:**

| Name                 | Type                                     | Required | Description                                   |
| -------------------- | ---------------------------------------- | -------- | --------------------------------------------- |
| `allow_wasi`         | Boolean<br/>_Default: True_              | ❌       | Allow WASI calls during initialization        |
| `component`          | Label                                    | ✅       | Input WebAssembly component to pre-initialize |
| `init_function_name` | String<br/>_Default: 'wizer.initialize'_ | ❌       | Name of the initialization function to call   |
| `name`               | String                                   | ✅       | A unique name for this target                 |
| `verbose`            | Boolean                                  | ❌       | Enable verbose output                         |

**Examples:**

Pre-initialize a WebAssembly component

```python
wasm_component_wizer_library(
    name = "optimized_component",
    component = ":my_component",
    init_function_name = "wizer.initialize",
    allow_wasi = True,
)
```

### wasm_validate

Validates WebAssembly components and modules using wasm-tools validate. Ensures WASM files are well-formed.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_validate")
```

**Attributes:**

| Name   | Type   | Required | Description                   |
| ------ | ------ | -------- | ----------------------------- |
| `name` | String | ✅       | A unique name for this target |
| `wasm` | Label  | ✅       | WASM file to validate         |

**Examples:**

Validate a WASM component

```python
wasm_validate(
    name = "validate_component",
    wasm = ":my_component",
)
```

### wasm_embed_aot

Embed AOT-compiled WebAssembly artifacts as custom sections in a component. This rule takes a WebAssembly component and embeds multiple AOT-compiled versions (.cwasm files) as custom sections, enabling universal deployment with architecture-specific optimization.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_embed_aot")
```

**Attributes:**

| Name            | Type                    | Required | Description                                           |
| --------------- | ----------------------- | -------- | ----------------------------------------------------- |
| `aot_artifacts` | String-keyed label dict | ✅       | Dictionary mapping target names to precompiled AOT artifacts |
| `component`     | Label                   | ✅       | Base WebAssembly component to embed AOT artifacts into |
| `name`          | String                  | ✅       | A unique name for this target                         |

**Examples:**

Multi-architecture AOT embedding

```python
wasm_embed_aot(
    name = "universal_component",
    component = ":my_component",
    aot_artifacts = {
        "linux_x64": ":component_x64_aot",
        "linux_arm64": ":component_arm64_aot",
        "portable": ":component_portable_aot",
    },
)
```

Production deployment with embedded optimizations

```python
# Create AOT artifacts for different platforms
wasm_precompile(
    name = "production_x64",
    component = ":service",
    target_triple = "x86_64-unknown-linux-gnu",
    optimization_level = "2",
)

wasm_precompile(
    name = "production_arm64",
    component = ":service",
    target_triple = "aarch64-unknown-linux-gnu",
    optimization_level = "2",
)

# Embed for universal deployment
wasm_embed_aot(
    name = "production_service",
    component = ":service",
    aot_artifacts = {
        "prod_x64": ":production_x64",
        "prod_arm64": ":production_arm64",
    },
)
```

### wasm_extract_aot

Extract an AOT-compiled artifact from a WebAssembly component. This rule extracts a specific AOT artifact that was previously embedded as a custom section, allowing runtime code to access the appropriate compiled version for the current architecture.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_extract_aot")
```

**Attributes:**

| Name          | Type   | Required | Description                                           |
| ------------- | ------ | -------- | ----------------------------------------------------- |
| `component`   | Label  | ✅       | WebAssembly component with embedded AOT artifacts    |
| `name`        | String | ✅       | A unique name for this target                         |
| `target_name` | String | ✅       | Target architecture name to extract (e.g., "linux_x64") |

**Examples:**

Extract specific architecture

```python
wasm_extract_aot(
    name = "extracted_x64_optimized",
    component = ":universal_component",
    target_name = "linux_x64",
)
```

Runtime architecture selection

```python
# Extract different architectures as needed
wasm_extract_aot(
    name = "runtime_x64",
    component = ":production_service",
    target_name = "prod_x64",
)

wasm_extract_aot(
    name = "runtime_arm64",
    component = ":production_service",
    target_name = "prod_arm64",
)
```

### wasm_precompile

Ahead-of-time (AOT) compile WebAssembly components using Wasmtime for faster startup times and improved performance.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_precompile")
```

**Attributes:**

| Name                 | Type    | Required | Description                                           |
| -------------------- | ------- | -------- | ----------------------------------------------------- |
| `component`          | Label   | ❌       | WasmComponent target to precompile                    |
| `debug_info`         | Boolean | ❌       | Include DWARF debug information (increases size ~8x)  |
| `name`               | String  | ✅       | A unique name for this target                         |
| `optimization_level` | String  | ❌       | Optimization level: "0", "1", "2", "s" (default: "2") |
| `target_triple`      | String  | ❌       | Target triple for cross-compilation                   |
| `wasm_file`          | Label   | ❌       | Input WebAssembly file to precompile                  |

**Examples:**

Production build (default: no debug info, 87% smaller)

```python
wasm_precompile(
    name = "my_component_aot",
    component = ":my_component",
    optimization_level = "2",
)
```

Debug build with DWARF debug information

```python
wasm_precompile(
    name = "my_component_debug",
    component = ":my_component",
    optimization_level = "0",
    debug_info = True,
)
```

Cross-compilation for specific architecture

```python
wasm_precompile(
    name = "my_component_x64",
    component = ":my_component",
    target_triple = "x86_64-unknown-linux-gnu",
    optimization_level = "2",
)
```

### wasm_run

Execute WebAssembly components using Wasmtime runtime. Automatically uses AOT compiled versions when available.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_run")
```

**Attributes:**

| Name                    | Type            | Required | Description                                           |
| ----------------------- | --------------- | -------- | ----------------------------------------------------- |
| `allow_wasi_filesystem` | Boolean         | ❌       | Allow WASI filesystem access (default: True)          |
| `allow_wasi_net`        | Boolean         | ❌       | Allow WASI network access (default: False)            |
| `component`             | Label           | ❌       | WebAssembly component to run                          |
| `cwasm_file`            | Label           | ❌       | Direct precompiled WebAssembly file                   |
| `module_args`           | List of strings | ❌       | Additional arguments to pass to module                |
| `name`                  | String          | ✅       | A unique name for this target                         |
| `prefer_aot`            | Boolean         | ❌       | Use AOT compiled version if available (default: True) |
| `wasm_file`             | Label           | ❌       | Direct WebAssembly module file                        |

**Examples:**

Run component with AOT preference

```python
wasm_run(
    name = "run_component",
    component = ":my_component_aot",
    allow_wasi_filesystem = True,
)
```

### wasm_test

Test WebAssembly components using Wasmtime runtime. Similar to wasm_run but designed for testing scenarios.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_test")
```

**Attributes:**

| Name                    | Type            | Required | Description                                           |
| ----------------------- | --------------- | -------- | ----------------------------------------------------- |
| `allow_wasi_filesystem` | Boolean         | ❌       | Allow WASI filesystem access (default: True)          |
| `allow_wasi_net`        | Boolean         | ❌       | Allow WASI network access (default: False)            |
| `component`             | Label           | ❌       | WebAssembly component to test                         |
| `cwasm_file`            | Label           | ❌       | Direct precompiled WebAssembly file                   |
| `module_args`           | List of strings | ❌       | Additional arguments to pass to module                |
| `name`                  | String          | ✅       | A unique name for this target                         |
| `prefer_aot`            | Boolean         | ❌       | Use AOT compiled version if available (default: True) |
| `wasm_file`             | Label           | ❌       | Direct WebAssembly module file                        |

**Examples:**

Test component functionality

```python
wasm_test(
    name = "component_test",
    component = ":my_component",
)
```

## Security & Signing

### wasm_keygen

Generates cryptographic keys for WebAssembly component signing using wasmsign2. Creates key pairs for secure component distribution.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_keygen")
```

**Attributes:**

| Name             | Type    | Required | Description                     |
| ---------------- | ------- | -------- | ------------------------------- |
| `name`           | String  | ✅       | A unique name for this target   |
| `openssh_format` | Boolean | ❌       | Generate keys in OpenSSH format |

**Examples:**

Create signing keys

```python
wasm_keygen(
    name = "production_keys",
    openssh_format = True,
)
```

### wasm_sign

Signs WebAssembly components using wasmsign2 for secure deployment. Provides cryptographic signatures for component integrity.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_sign")
```

**Attributes:**

| Name             | Type                         | Required | Description                                              |
| ---------------- | ---------------------------- | -------- | -------------------------------------------------------- |
| `component`      | Label                        | ❌       | WebAssembly component to sign (alternative to wasm_file) |
| `detached`       | Boolean<br/>_Default: False_ | ❌       | Create detached signature file                           |
| `keys`           | Label                        | ❌       | Key pair from wasm_keygen or ssh_keygen                  |
| `name`           | String                       | ✅       | A unique name for this target                            |
| `openssh_format` | Boolean<br/>_Default: False_ | ❌       | Use OpenSSH key format (when not using keys attribute)   |
| `secret_key`     | Label                        | ❌       | Secret key file (alternative to keys)                    |
| `wasm_file`      | Label                        | ❌       | WASM file to sign (alternative to component)             |

**Examples:**

Sign a WebAssembly component with embedded signature

```python
wasm_sign(
    name = "signed_component",
    component = ":my_component",
    keys = ":signing_keys",
    detached = false,
)
```

### wasm_verify

Verifies signatures of signed WebAssembly components using wasmsign2. Validates component authenticity and integrity.

**Load from:**

```python
load("@rules_wasm_component//wasm:defs.bzl", "wasm_verify")
```

**Attributes:**

| Name               | Type   | Required | Description                                           |
| ------------------ | ------ | -------- | ----------------------------------------------------- |
| `github_account`   | String | ❌       | GitHub account for key verification                   |
| `keys`             | Label  | ❌       | Public key from key pair                              |
| `name`             | String | ✅       | A unique name for this target                         |
| `signed_component` | Label  | ❌       | Signed component to verify                            |
| `split_regex`      | String | ❌       | Regular expression for partial verification           |
| `wasm_file`        | Label  | ❌       | WASM file to verify (alternative to signed_component) |

**Examples:**

Verify a signed WebAssembly component

```python
wasm_verify(
    name = "verify_component",
    signed_component = ":signed_component",
    keys = ":signing_keys",
)
```

## Registry & Distribution

### wasm_component_from_oci

Downloads WebAssembly components from OCI registries. Enables using remote components from container registries in builds.

**Load from:**

```python
load("@rules_wasm_component//wkg:defs.bzl", "wasm_component_from_oci")
```

**Attributes:**

| Name              | Type                           | Required | Description                   |
| ----------------- | ------------------------------ | -------- | ----------------------------- |
| `component_name`  | String                         | ✅       | Component name                |
| `name`            | String                         | ✅       | A unique name for this target |
| `namespace`       | String                         | ✅       | Registry namespace            |
| `registry`        | String                         | ✅       | Registry hostname             |
| `registry_config` | Label                          | ❌       | Registry configuration        |
| `tag`             | String<br/>_Default: 'latest'_ | ❌       | Component tag or version      |

**Examples:**

Pull component from OCI registry

```python
wasm_component_from_oci(
    name = "auth_service",
    registry = "ghcr.io",
    namespace = "my-org",
    component_name = "auth-service",
    tag = "v1.0.0",
)
```

### wkg_registry_config

Configures WebAssembly component registries for OCI distribution. Sets up authentication and registry endpoints for component publishing and retrieval.

**Load from:**

```python
load("@rules_wasm_component//wkg:defs.bzl", "wkg_registry_config")
```

**Attributes:**

| Name                     | Type            | Required | Description                          |
| ------------------------ | --------------- | -------- | ------------------------------------ |
| `cache_dir`              | String          | ❌       | Directory for caching components     |
| `default_registry`       | String          | ❌       | Default registry to use              |
| `enable_mirror_fallback` | Boolean         | ❌       | Enable fallback to mirror registries |
| `name`                   | String          | ✅       | A unique name for this target        |
| `registries`             | List of Strings | ✅       | List of registry configurations      |

**Examples:**

Configure multiple component registries

```python
wkg_registry_config(
    name = "production_registries",
    registries = [
        "github|ghcr.io|oci|env|GITHUB_TOKEN",
        "docker|docker.io|oci|env|DOCKER_TOKEN",
    ],
    default_registry = "github",
)
```

### wkg_fetch

Fetches WebAssembly components from WKG (WebAssembly Package Tools) registries. Downloads components and their dependencies for use in builds.

**Load from:**

```python
load("@rules_wasm_component//wkg:defs.bzl", "wkg_fetch")
```

**Attributes:**

| Name       | Type   | Required | Description                   |
| ---------- | ------ | -------- | ----------------------------- |
| `name`     | String | ✅       | A unique name for this target |
| `package`  | String | ✅       | Package name to fetch         |
| `registry` | String | ❌       | Custom registry URL           |
| `version`  | String | ✅       | Package version to fetch      |

**Examples:**

Fetch a component from WKG registry

```python
wkg_fetch(
    name = "wasi_http_component",
    package = "wasi:http",
    version = "0.2.0",
)
```

### wkg_lock

Generates WKG lock files for dependency management. Creates lock files that pin specific versions of WebAssembly component dependencies.

**Load from:**

```python
load("@rules_wasm_component//wkg:defs.bzl", "wkg_lock")
```

**Attributes:**

| Name           | Type            | Required | Description                             |
| -------------- | --------------- | -------- | --------------------------------------- |
| `dependencies` | List of Strings | ✅       | List of package dependencies to lock    |
| `name`         | String          | ✅       | A unique name for this target           |
| `package_name` | String          | ✅       | Name of the package being locked        |
| `registry`     | String          | ❌       | Custom registry URL                     |

**Examples:**

Generate lock file for dependencies

```python
wkg_lock(
    name = "dependencies_lock",
    package_name = "example:dependencies",
    dependencies = [
        "wasi:http:0.2.0",
        "wasi:clocks:0.2.0",
        "wasi:filesystem:0.2.0",
    ],
)
```

### wkg_publish

Publishes WebAssembly components to WKG registries. Uploads components with metadata to package registries for distribution.

**Load from:**

```python
load("@rules_wasm_component//wkg:defs.bzl", "wkg_publish")
```

**Attributes:**

| Name           | Type            | Required | Description                       |
| -------------- | --------------- | -------- | --------------------------------- |
| `authors`      | List of Strings | ✅       | List of component authors         |
| `component`    | Label           | ✅       | WebAssembly component to publish  |
| `description`  | String          | ✅       | Component description             |
| `license`      | String          | ✅       | License identifier                |
| `name`         | String          | ✅       | A unique name for this target     |
| `package_name` | String          | ✅       | Package name for publication      |
| `registry`     | String          | ❌       | Custom registry URL               |
| `version`      | String          | ✅       | Package version                   |

**Examples:**

Publish component to WKG registry

```python
wkg_publish(
    name = "publish_example",
    package_name = "example:my-component",
    authors = ["Example Developer"],
    component = ":example_component_release",
    description = "An example WebAssembly component",
    license = "Apache-2.0",
    version = "1.0.0",
)
```

### wkg_push

Pushes WebAssembly components to OCI registries using WKG. Uploads components to container registries for OCI-based distribution.

**Load from:**

```python
load("@rules_wasm_component//wkg:defs.bzl", "wkg_push")
```

**Attributes:**

| Name              | Type   | Required | Description                       |
| ----------------- | ------ | -------- | --------------------------------- |
| `component`       | Label  | ✅       | WebAssembly component to push     |
| `image_reference` | String | ✅       | OCI image reference (registry/org/name:tag) |
| `name`            | String | ✅       | A unique name for this target     |
| `registry_config` | Label  | ❌       | Registry configuration            |

**Examples:**

Push component to OCI registry

```python
wkg_push(
    name = "push_to_github",
    component = ":my_component",
    image_reference = "ghcr.io/myorg/my-component:v1.0.0",
    registry_config = ":registries",
)
```

## Providers

### WacCompositionInfo

Provider that contains information about a WAC composition of multiple components.

**Provider Fields:**

| Field             | Type            | Description                                       |
| ----------------- | --------------- | ------------------------------------------------- |
| `components`      | dict            | Dictionary of component name to WasmComponentInfo |
| `composed_wasm`   | File            | The composed WASM file                            |
| `composition_wit` | File            | WIT file describing the composition               |
| `connections`     | List of Strings | List of inter-component connections               |
| `instantiations`  | List of Strings | List of component instantiations                  |

**Examples:**

Access composition metadata

```python
def _my_rule_impl(ctx):
    composition_info = ctx.attr.composition[WacCompositionInfo]
    composed_wasm = composition_info.composed_wasm
    components = composition_info.components
    # Use composition_info...
```

### WasmComponentInfo

Provider that contains information about a compiled WebAssembly component.

**Provider Fields:**

| Field            | Type            | Description                                      |
| ---------------- | --------------- | ------------------------------------------------ |
| `component_type` | String          | Type of component (module or component)          |
| `exports`        | List of Strings | List of exported interfaces                      |
| `imports`        | List of Strings | List of imported interfaces                      |
| `metadata`       | dict            | Component metadata dictionary                    |
| `wasm_file`      | File            | The compiled WASM component file                 |
| `wit_info`       | WitInfo         | WitInfo provider from the component's interfaces |

**Examples:**

Access component metadata

```python
def _my_rule_impl(ctx):
    component_info = ctx.attr.component[WasmComponentInfo]
    wasm_file = component_info.wasm_file
    exports = component_info.exports
    # Use component_info...
```

### WasmPrecompiledInfo

Provider that contains information about precompiled WebAssembly components (AOT compilation results).

**Provider Fields:**

| Field                | Type            | Description                                   |
| -------------------- | --------------- | --------------------------------------------- |
| `compatibility_hash` | String          | Hash for compatibility checking across builds |
| `compilation_flags`  | List of Strings | List of compilation flags used                |
| `cwasm_file`         | File            | Precompiled .cwasm file                       |
| `optimization_level` | String          | Optimization level used (0, 1, 2, s)          |
| `source_wasm`        | File            | Original WASM file that was precompiled       |
| `target_arch`        | String          | Target architecture (x86_64, aarch64, etc.)   |
| `wasmtime_version`   | String          | Version of Wasmtime used for compilation      |

**Examples:**

Access precompiled component information

```python
def _my_rule_impl(ctx):
    if WasmPrecompiledInfo in ctx.attr.component:
        precompiled_info = ctx.attr.component[WasmPrecompiledInfo]
        cwasm_file = precompiled_info.cwasm_file
        optimization = precompiled_info.optimization_level
        # Use precompiled version...
    else:
        # Fallback to regular component...
```

### WitInfo

Provider that contains information about WIT interfaces and their dependencies.

**Provider Fields:**

| Field             | Type            | Description                                     |
| ----------------- | --------------- | ----------------------------------------------- |
| `interface_names` | List of Strings | List of interface names defined in this library |
| `package_name`    | String          | WIT package name (e.g., 'my:package@1.0.0')     |
| `wit_deps`        | Depset          | Depset of transitive WIT dependencies           |
| `wit_files`       | Depset          | Depset of WIT source files for this library     |
| `world_name`      | String          | World name exported by this library (optional)  |

**Examples:**

Access WIT metadata in rule implementations

```python
def _my_rule_impl(ctx):
    wit_info = ctx.attr.wit[WitInfo]
    package_name = wit_info.package_name
    wit_files = wit_info.wit_files.to_list()
    # Use wit_info...
```
