# Pre-commit Setup Guide

This project uses [pre-commit](https://pre-commit.com/) hooks to ensure code quality and consistency.

## Quick Setup

```bash
# Install pre-commit (if not already installed)
pip install pre-commit
# or: brew install pre-commit

# Install the git hook scripts
pre-commit install

# Install commit-msg hook for conventional commits
pre-commit install --hook-type commit-msg
```

## What the hooks do

### Code Formatting
- **Buildifier**: Formats Bazel files (`.bzl`, `.bazel`, `BUILD`)
- **Black**: Formats Python files 
- **isort**: Sorts Python imports
- **rustfmt**: Formats Rust files
- **gofmt**: Formats Go files
- **Prettier**: Formats JS/TS/JSON/YAML/Markdown

### Code Quality
- **Clippy**: Rust linting via Bazel (`bazel build //:clippy`)
- **WIT validation**: Checks WIT file syntax
- **Bazel tests**: Runs unit tests for changed files

### Security & Standards
- **Conventional commits**: Enforces conventional commit message format
- **Secret detection**: Prevents committing secrets
- **File checks**: Trailing whitespace, file endings, merge conflicts

## Usage

### Automatic (recommended)
After installation, hooks run automatically on every commit:

```bash
git add .
git commit -m "feat: add new component rule"
# Pre-commit hooks run automatically
```

### Manual
Run all hooks on all files:

```bash
pre-commit run --all-files
```

Run specific hooks:

```bash
pre-commit run buildifier
pre-commit run rust-clippy
```

## Conventional Commits

This project uses [Conventional Commits](https://www.conventionalcommits.org/):

```bash
git commit -m "feat: add WebAssembly component validation"
git commit -m "fix: resolve TinyGo compilation issue"  
git commit -m "docs: update README with examples"
git commit -m "refactor: modernize shell script usage"
```

**Allowed types**: `feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`, `build`, `ci`, `chore`

## Integration with Existing Tools

This setup integrates with existing project tools:

- **Buildifier** (already in `//:buildifier`)
- **Clippy** (already in `//:clippy`) 
- **git-cliff** (uses conventional commits for changelog)

## Troubleshooting

**Hook fails?**
```bash
# Skip hooks for emergency commits
git commit --no-verify -m "fix: emergency fix"

# Fix issues and re-commit normally
```

**Update hooks:**
```bash
pre-commit autoupdate
```

**Clean hook cache:**
```bash
pre-commit clean
```